
## 1. 프로젝트 개요

### 1.1. 목표

Supabase 백엔드 서비스와 NextJS 15(App Router)를 활용하여 사용자 친화적인 출입 신청 페이지 및 관리 효율성을 극대화한 관리자 대시보드를 구축하는 것을 목표로 한다. 본 문서는 MVP 개발을 위한 기능 정의와 향후 2단계의 이터레이션을 포함하며, AI 코딩 에이전트(v0, Cursor 등)가 이를 기반으로 코드를 작성할 수 있도록 상세하게 기술한다.

### 1.2. 기술 스택

- **프론트엔드:** Next.js 15 (App Router), React, Tailwind CSS
- **백엔드/DB:** Supabase (PostgreSQL, Storage, Edge Functions)
- **협업 도구 연동:** Microsoft Teams, Power Apps, Power Automate (관리자화면, 초기 MVP에서는 연동 로직만 설계)

## 2. Phase 1 (MVP) 요구사항

### 2.1. 사용자 스토리 (User Stories)

### 사용자 (출입 신청자)

1. **출입 신청하기:** "출입 신청을 위해 메인 화면에 접속하면, 직관적인 메뉴를 통해 쉽게 '출입 신청' 페이지로 이동하고 싶어요. 이용 약관 동의와 전자 서명을 완료하고, 이름, 전화번호, 소속 업체, 공사명, 차량 정보 등 필수 정보를 입력하여 신청을 완료하고 싶어요."
2. **신청 내역 조회하기:** "회원가입 없이도 전화번호만 입력하면 제가 신청한 내역을 쉽게 조회하고 싶어요. 신청의 승인 상태(대기/완료)를 확인하고, 승인 대기 중에는 신청 내용을 수정할 수 있었으면 좋겠어요. 승인 완료 시에는 QR 코드를 확인하거나 다운로드하여 현장 출입에 사용하고 싶어요."
3. **안전 교육 및 정보 확인하기:** "현장에 도착하기 전에 안전 관리 페이지에서 현장 안전 시설 위치와 필요한 자료를 확인하고 싶어요. MSDS 같은 안전 관련 자료를 다운로드하고, 현장에서 QR 코드를 스캔하여 안전 교육을 이수하고 싶어요."

### 관리자

1. **출입 신청 승인하기:** "관리자 페이지에 접속하면, '승인 대기' 중인 출입 신청 목록을 한눈에 보고, 검색 및 필터링 기능을 활용하여 특정 신청자를 빠르게 찾고 일괄 승인으로 효율적으로 처리하고 싶어요."
2. **현장 출입 현황 파악하기:** "대시보드에서 현재 출입 중인 인원과 퇴근한 인원을 실시간으로 확인하고, 일자별 출입 통계를 차트와 그래프 형태로 시각화하여 보고 싶어요."
3. **공사 및 업체 정보 관리하기:** "공사 계획 관리 페이지에서 새로운 공사를 등록하고, 기간이나 담당자를 쉽게 수정하고 싶어요. 출입 신청을 통해 자동으로 등록된 업체 정보를 확인하고 필요에 따라 수정하고 싶어요."

### 2.2. 기능 명세 (Feature Specification)

### 입력 (Input)

- **사용자 웹 양식:** 이름(String), 전화번호(String), 소속 업체명(String), 공사명(String), 차량번호(String), 동의 일시(Timestamp), IP 주소(String), 전자 서명 이미지(Base64 String).
- **자동 입력:** 출입 신청 시, 소속 업체가 DB에 없으면 `업체관리Table`에 자동 등록.
- **관리자 입력:** 공사명(String), 공사 기간(Date), 공사 내용(String), 담당 관리자(String).
- **Supabase File Storage:** 관리자가 MSDS, 안전 교육 자료 등을 업로드.

### 처리 (Processing)

- **데이터 유효성 검사:** 전화번호, 이메일 등의 형식은 정규식을 사용하여 검증.
- **QR 코드 생성:** Supabase Edge Functions를 사용하여 출입 신청 고유 ID를 기반으로 QR 코드 이미지를 생성하고 Supabase Storage에 저장.
- **상태 관리:** 출입 신청의 `승인_상태` 필드에 따라 '대기'/'완료' 값을 저장하고, 이를 기반으로 UI 동적 변경.
- **데이터베이스 연동:** 출입 신청 완료 시 `출입자관리Table`에 데이터를 추가하고, `업체관리Table`과 `공사관리Table`에 대한 FK(Foreign Key)를 관리.

### 출력 (Output)

- **웹 UI:** Tailwind CSS 기반의 반응형 레이아웃.
- **테이블/목록:** 관리자 페이지에 출입 신청 목록, 공사/업체 목록을 테이블 형태로 출력.
- **대시보드:** 출입 통계 및 현황을 시각화한 막대 그래프, 파이 차트.
- **QR 코드:** 승인 완료 시, `Supabase Storage`에 저장된 QR 코드 이미지 링크를 사용자에게 제공.
- **파일 다운로드:** `Supabase Storage`에 업로드된 MSDS 파일을 다운로드 가능한 링크로 제공.

### 행동 (Actions)

- **사용자:** 출입 신청, 신청 내용 수정, QR 코드 전송/다운로드, 파일 다운로드, 안전 교육 QR 스캔.
- **관리자:** 출입 신청 승인/반려(개별 및 일괄), 공사/업체/관리자 정보 등록/수정/삭제, 출입 통계/현황 조회, 보고서(CSV/PDF) 다운로드.

### 검수 (Validation)

**[사용자 스토리 기반 테스트 케이스]**

- **A1:** '출입 신청' 페이지에서 '이용 약관 동의' 체크박스에 동의하지 않으면, **B1:** '다음' 버튼이 비활성화되어야 한다.
- **A2:** 모든 필수 입력란을 채우지 않고 신청 버튼을 누르면, **B2:** '필수 정보를 입력해주세요'라는 메시지가 표시되어야 한다.
- **A3:** '신청 조회' 페이지에서 올바른 전화번호를 입력하면, **B3:** 해당 전화번호로 신청된 모든 내역이 조회되어야 한다.
- **A4:** '신청 조회' 결과가 '승인 대기' 상태일 때, **B4:** '수정' 버튼이 활성화되어야 하고, **C4:** '승인 완료' 상태일 때는 'QR 코드 전송' 버튼이 활성화되어야 한다.
- **A5:** '안전 관리' 페이지에서 MSDS 파일 링크를 클릭하면, **B5:** 해당 파일이 다운로드되어야 한다.

**[관리자 스토리 기반 테스트 케이스]**

- **A6:** 관리자 페이지의 '승인 대기' 탭에서 여러 신청을 선택하고 '일괄 승인' 버튼을 누르면, **B6:** 선택된 모든 신청의 `승인_상태`가 '승인 완료'로 변경되어야 한다.
- **A7:** 출입 신청 시, 이전에 등록되지 않은 신규 업체명이 입력되면, **B7:** `업체관리Table`에 새로운 업체 정보가 자동으로 추가되어야 한다.
- **A8:** 관리자 대시보드에 접속하면, **B8:** `출입관리Table` 데이터를 기반으로 현재 현장 인원이 실시간으로 업데이트되어 보여야 한다.
- **A9:** 관리자가 공사 계획을 등록할 때, **B9:** 필수 정보(공사명, 기간)를 입력하지 않으면 등록 버튼이 비활성화되어야 한다.
